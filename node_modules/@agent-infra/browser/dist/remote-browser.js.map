{"version":3,"file":"remote-browser.js","sources":["webpack://@agent-infra/browser/./src/remote-browser.ts"],"sourcesContent":["/*\n * Copyright (c) 2025 Bytedance, Inc. and its affiliates.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport * as puppeteer from 'puppeteer-core';\nimport { BaseBrowser, BaseBrowserOptions } from './base-browser';\nimport { LaunchOptions } from './types';\n\n/**\n * Configuration options for RemoteBrowser\n * @extends BaseBrowserOptions\n * @interface RemoteBrowserOptions\n * @property {string} [wsEndpoint] - WebSocket endpoint URL for direct connection\n * @property {string} [cdpEndpoint] - Remote Chrome DevTools Protocol endpoint\n */\nexport interface RemoteBrowserOptions extends BaseBrowserOptions {\n  wsEndpoint?: string;\n  /** @default http://localhost:9222/json/version */\n  cdpEndpoint?: string;\n}\n\n/**\n * RemoteBrowser class for connecting to remote browser instances\n *\n * Currently, this RemoteBrowser is not production ready,\n * mainly because it still relies on `puppeteer-core`,\n * which can only run on Node.js.\n *\n * At the same time, Chrome instances built with\n * `--remote-debugging-address` on Linux have security risks\n *\n * @see https://issues.chromium.org/issues/41487252\n * @see https://issues.chromium.org/issues/40261787\n * @see https://github.com/pyppeteer/pyppeteer/pull/379\n * @see https://stackoverflow.com/questions/72760355/chrome-remote-debugging-not-working-computer-to-computer\n *\n * @extends BaseBrowser\n */\nexport class RemoteBrowser extends BaseBrowser {\n  /**\n   * Creates a new RemoteBrowser instance\n   * @param {RemoteBrowserOptions} [options] - Configuration options for remote browser connection\n   */\n  constructor(private options?: RemoteBrowserOptions) {\n    super(options);\n  }\n\n  /**\n   * Connects to a remote browser instance using WebSocket\n   * If no WebSocket endpoint is provided, attempts to discover it using the DevTools Protocol\n   * @param {LaunchOptions} [options] - Launch configuration options\n   * @returns {Promise<void>} Promise that resolves when connected to the remote browser\n   * @throws {Error} If connection to the remote browser fails\n   */\n  async launch(options?: LaunchOptions): Promise<void> {\n    this.logger.info('Browser Launch options:', options);\n\n    let browserWSEndpoint = this.options?.wsEndpoint;\n\n    if (!browserWSEndpoint) {\n      const cdpEndpoint =\n        this.options?.cdpEndpoint || `http://127.0.0.1:9222/json/version`;\n      const response = await fetch(cdpEndpoint);\n      const { webSocketDebuggerUrl } = await response.json();\n      browserWSEndpoint = webSocketDebuggerUrl;\n    }\n\n    this.logger.info('Using WebSocket endpoint:', browserWSEndpoint);\n\n    const puppeteerConnectOptions: puppeteer.ConnectOptions = {\n      browserWSEndpoint,\n      defaultViewport: options?.defaultViewport ?? { width: 1280, height: 800 },\n    };\n\n    try {\n      this.browser = await puppeteer.connect(puppeteerConnectOptions);\n      await this.setupPageListener();\n      this.logger.success('Connected to remote browser successfully');\n    } catch (error) {\n      this.logger.error('Failed to connect to remote browser:', error);\n      throw error;\n    }\n  }\n}\n"],"names":["RemoteBrowser","BaseBrowser","options","_this_options","browserWSEndpoint","_this_options1","cdpEndpoint","response","fetch","webSocketDebuggerUrl","puppeteerConnectOptions","puppeteer","error"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGC;;;;;;;;;;AAmCM,MAAMA,sBAAsBC,yCAAAA,WAAWA;IAgB5C,MAAM,OAAOC,OAAuB,EAAiB;YAG3BC;QAFxB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,2BAA2BD;QAE5C,IAAIE,oBAAoB,AAAY,SAAZD,CAAAA,gBAAAA,IAAI,CAAC,OAAO,AAAD,KAAXA,AAAAA,KAAAA,MAAAA,gBAAAA,KAAAA,IAAAA,cAAc,UAAU;QAEhD,IAAI,CAACC,mBAAmB;gBAEpBC;YADF,MAAMC,cACJD,AAAAA,CAAY,SAAZA,CAAAA,iBAAAA,IAAI,CAAC,OAAO,AAAD,KAAXA,AAAAA,KAAAA,MAAAA,iBAAAA,KAAAA,IAAAA,eAAc,WAAW,AAAD,KAAK;YAC/B,MAAME,WAAW,MAAMC,MAAMF;YAC7B,MAAM,EAAEG,oBAAoB,EAAE,GAAG,MAAMF,SAAS,IAAI;YACpDH,oBAAoBK;QACtB;QAEA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,6BAA6BL;QAE9C,MAAMM,0BAAoD;YACxDN;YACA,iBAAiBF,AAAAA,CAAAA,QAAAA,UAAAA,KAAAA,IAAAA,QAAS,eAAe,AAAD,KAAK;gBAAE,OAAO;gBAAM,QAAQ;YAAI;QAC1E;QAEA,IAAI;YACF,IAAI,CAAC,OAAO,GAAG,MAAMS,wCAAAA,OAAiB,CAACD;YACvC,MAAM,IAAI,CAAC,iBAAiB;YAC5B,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;QACtB,EAAE,OAAOE,OAAO;YACd,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,wCAAwCA;YAC1D,MAAMA;QACR;IACF;IAvCA,YAAoBV,OAA8B,CAAE;QAClD,KAAK,CAACA,UAAAA,iBAAAA,IAAAA,EAAAA,WAAAA,KAAAA,IAAAA,IAAAA,CADYA,OAAO,GAAPA;IAEpB;AAsCF"}