{"version":3,"file":"common/promise-queue.js","sources":["webpack://@agent-infra/shared/./src/common/promise-queue.ts"],"sourcesContent":["/*\n * Copyright (c) 2025 Bytedance, Inc. and its affiliates.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface Task<T> {\n  (): Promise<T>;\n}\n\nexport class PromiseQueue {\n  private queue: Task<any>[] = [];\n\n  private concurrency: number;\n\n  private running = 0;\n\n  private results: any[] = [];\n\n  constructor(concurrency = 1) {\n    this.concurrency = concurrency;\n  }\n\n  add<T>(task: Task<T>): Promise<T> {\n    return new Promise((resolve, reject) => {\n      this.queue.push(async () => {\n        try {\n          const result = await task();\n          resolve(result);\n          return result;\n        } catch (error) {\n          reject(error);\n          throw error;\n        }\n      });\n      this.run();\n    });\n  }\n\n  private async run() {\n    if (this.running >= this.concurrency || this.queue.length === 0) {\n      return;\n    }\n\n    this.running++;\n    const task = this.queue.shift()!;\n\n    try {\n      const result = await task();\n      this.results.push(result);\n    } catch (error) {\n      // Handle error if needed\n    } finally {\n      this.running--;\n      this.run();\n    }\n  }\n\n  async waitAll(): Promise<any[]> {\n    while (this.running > 0 || this.queue.length > 0) {\n      await new Promise((resolve) => setTimeout(resolve, 100));\n    }\n    return this.results;\n  }\n}\n"],"names":["PromiseQueue","task","Promise","resolve","reject","result","error","setTimeout","concurrency"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGC;;;;;;;;;;AAMM,MAAMA;IAaX,IAAOC,IAAa,EAAc;QAChC,OAAO,IAAIC,QAAQ,CAACC,SAASC;YAC3B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;gBACd,IAAI;oBACF,MAAMC,SAAS,MAAMJ;oBACrBE,QAAQE;oBACR,OAAOA;gBACT,EAAE,OAAOC,OAAO;oBACdF,OAAOE;oBACP,MAAMA;gBACR;YACF;YACA,IAAI,CAAC,GAAG;QACV;IACF;IAEA,MAAc,MAAM;QAClB,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,WAAW,IAAI,AAAsB,MAAtB,IAAI,CAAC,KAAK,CAAC,MAAM,EACvD;QAGF,IAAI,CAAC,OAAO;QACZ,MAAML,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK;QAE7B,IAAI;YACF,MAAMI,SAAS,MAAMJ;YACrB,IAAI,CAAC,OAAO,CAAC,IAAI,CAACI;QACpB,EAAE,OAAOC,OAAO,CAEhB,SAAU;YACR,IAAI,CAAC,OAAO;YACZ,IAAI,CAAC,GAAG;QACV;IACF;IAEA,MAAM,UAA0B;QAC9B,MAAO,IAAI,CAAC,OAAO,GAAG,KAAK,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,EAC7C,MAAM,IAAIJ,QAAQ,CAACC,UAAYI,WAAWJ,SAAS;QAErD,OAAO,IAAI,CAAC,OAAO;IACrB;IA5CA,YAAYK,cAAc,CAAC,CAAE;QAR7B,uBAAQ,SAAqB,EAAE;QAE/B,uBAAQ,eAAR;QAEA,uBAAQ,WAAU;QAElB,uBAAQ,WAAiB,EAAE;QAGzB,IAAI,CAAC,WAAW,GAAGA;IACrB;AA2CF"}