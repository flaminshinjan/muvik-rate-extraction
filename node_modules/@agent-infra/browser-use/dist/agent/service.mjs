/**
* Copyright (c) 2025 Bytedance, Inc. and its affiliates.
* SPDX-License-Identifier: Apache-2.0
*/
import * as __WEBPACK_EXTERNAL_MODULE_uuid__ from "uuid";
import * as __WEBPACK_EXTERNAL_MODULE__browser_context_mjs_e4c994b1__ from "../browser/context.mjs";
import * as __WEBPACK_EXTERNAL_MODULE__executor_mjs_2e1a96d7__ from "./executor.mjs";
import * as __WEBPACK_EXTERNAL_MODULE__event_types_mjs_55097f94__ from "./event/types.mjs";
function _define_property(obj, key, value) {
    if (key in obj) Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
    });
    else obj[key] = value;
    return obj;
}
class Agent {
    subscribeToExecutorEvents(executor) {
        executor.clearExecutionEvents();
        executor.subscribeExecutionEvents(async (event)=>{
            try {
                var _this_registerNewStepCallback, _this;
                null === (_this_registerNewStepCallback = (_this = this).registerNewStepCallback) || void 0 === _this_registerNewStepCallback || _this_registerNewStepCallback.call(_this, event);
            } catch (error) {
                console.error('Failed to send message to side panel:', error);
            }
            if (event.state === __WEBPACK_EXTERNAL_MODULE__event_types_mjs_55097f94__.ExecutionState.TASK_OK || event.state === __WEBPACK_EXTERNAL_MODULE__event_types_mjs_55097f94__.ExecutionState.TASK_FAIL || event.state === __WEBPACK_EXTERNAL_MODULE__event_types_mjs_55097f94__.ExecutionState.TASK_CANCEL) {
                var _this_executor;
                await (null === (_this_executor = this.executor) || void 0 === _this_executor ? void 0 : _this_executor.cleanup());
            }
        });
    }
    async run(task) {
        this.executor = new __WEBPACK_EXTERNAL_MODULE__executor_mjs_2e1a96d7__.Executor(task, `${(0, __WEBPACK_EXTERNAL_MODULE_uuid__.v4)()}`, this.browserContext, this.llm, {
            plannerLLM: this.llm,
            validatorLLM: this.llm
        });
        this.subscribeToExecutorEvents(this.executor);
        const result = await this.executor.execute();
        console.info('new_task execution result', result);
    }
    constructor(llm, options){
        _define_property(this, "llm", void 0);
        _define_property(this, "browserContext", void 0);
        _define_property(this, "registerNewStepCallback", void 0);
        _define_property(this, "executor", void 0);
        this.llm = llm;
        this.browserContext = new __WEBPACK_EXTERNAL_MODULE__browser_context_mjs_e4c994b1__["default"]((null == options ? void 0 : options.browserContextConfig) || {});
        this.registerNewStepCallback = null == options ? void 0 : options.registerNewStepCallback;
    }
}
export { Agent };

//# sourceMappingURL=service.mjs.map